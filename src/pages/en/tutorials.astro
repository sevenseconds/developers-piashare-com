---
import MicroBlogLayout from '../../layouts/MicroBlogLayout.astro';
import { getCollection } from 'astro:content';

// Get all blog posts
const allPosts = await getCollection('blog');

// Filter English tutorials
const englishPosts = allPosts.filter(post => post.data.lang === 'en');

// Organize tutorials by programming languages/frameworks
const tutorialsByCategory = {
  'JavaScript': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['JavaScript', 'JS', 'React', 'Vue', 'Angular', 'Node.js'].includes(tag))
  ),
  'API': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['API', 'REST', 'GraphQL', 'Backend'].includes(tag))
  ),
  'Frontend': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['Frontend', 'CSS', 'HTML', 'UI', 'Responsive'].includes(tag))
  ),
  'Tools': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['Tools', 'Setup', 'DevOps', 'Terminal', 'CLI'].includes(tag))
  ),
  'Python': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['Python', 'Django', 'Flask', 'FastAPI'].includes(tag))
  ),
  'Mobile': englishPosts.filter(post => 
    post.data.tags?.some(tag => ['Mobile', 'React Native', 'Flutter', 'iOS', 'Android'].includes(tag))
  )
};

// Remove empty categories
const nonEmptyCategories = Object.entries(tutorialsByCategory).filter(([_, posts]) => posts.length > 0);
---

<MicroBlogLayout title="Tutorials - PiaShare Developers">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl sm:text-5xl font-bold mb-4 text-gray-900 dark:text-white">Programming Tutorials</h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">Learn new technologies and improve your programming skills</p>
    </div>

    <!-- Programming Languages Overview -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-12">
      <a href="/en/languages/javascript" class="group bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800 hover:border-yellow-400 transition-all duration-200">
        <div class="w-12 h-12 bg-yellow-400 rounded-lg flex items-center justify-center mb-3">
          <span class="text-black font-bold text-lg">JS</span>
        </div>
        <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-yellow-600">JavaScript</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Web Development</p>
      </a>

      <a href="/en/languages/python" class="group bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800 hover:border-blue-500 transition-all duration-200">
        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mb-3">
          <span class="text-white font-bold text-lg">PY</span>
        </div>
        <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-blue-600">Python</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Data & AI</p>
      </a>

      <a href="/en/languages/typescript" class="group bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800 hover:border-blue-600 transition-all duration-200">
        <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mb-3">
          <span class="text-white font-bold text-lg">TS</span>
        </div>
        <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-blue-700">TypeScript</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Type Safety</p>
      </a>

      <a href="/en/languages/rust" class="group bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800 hover:border-orange-600 transition-all duration-200">
        <div class="w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center mb-3">
          <span class="text-white font-bold text-lg">RS</span>
        </div>
        <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-orange-700">Rust</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Systems</p>
      </a>

      <a href="/en/languages/go" class="group bg-white dark:bg-gray-900 rounded-xl p-6 border border-gray-200 dark:border-gray-800 hover:border-cyan-500 transition-all duration-200">
        <div class="w-12 h-12 bg-cyan-500 rounded-lg flex items-center justify-center mb-3">
          <span class="text-white font-bold text-lg">GO</span>
        </div>
        <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-cyan-600">Go</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Backend</p>
      </a>
    </div>

    <!-- Tutorial Categories -->
    <div class="space-y-8">
      {nonEmptyCategories.map(([category, posts]) => (
        <div class="bg-white dark:bg-gray-900 rounded-2xl p-6 border border-gray-200 dark:border-gray-800">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{category}</h2>
            <span class="text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full">
              {posts.length} tutorial{posts.length !== 1 ? 's' : ''}
            </span>
          </div>
          
          <div class="grid gap-4">
            {posts.map((post) => (
              <a href={`/en/posts/${post.id.replace('en/', '')}`} class="block p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 mb-2">
                      {post.data.title}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2">
                      {post.data.subtitle || post.data.description}
                    </p>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 space-x-4">
                        <span>{post.data.author}</span>
                        <span>{post.data.readTime}</span>
                      </div>
                      <div class="flex flex-wrap gap-1">
                        {post.data.tags?.slice(0, 3).map((tag) => (
                          <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full">
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- All Tutorials fallback -->
    {nonEmptyCategories.length === 0 && (
      <div class="text-center py-12">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Tutorials Coming Soon</h2>
        <p class="text-gray-600 dark:text-gray-400">We're constantly updating with new tutorials. Check back soon!</p>
      </div>
    )}
  </div>
</MicroBlogLayout>